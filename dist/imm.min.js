//! Imm
//! Immutable collections
//! (c) 2015 Sebastian Porto
//! MIT license.
//! https://github.com/sporto/imm
!function(r,t){if("function"==typeof define&&define.amd)define(["seamless-immutable"],function(e){return r.imm=t(e)});else if("object"==typeof exports){var e=require("seamless-immutable");module.exports=t(e)}else r.imm=t(r.Immutable)}(this,function(r){"use strict";function t(r){return y(r)?r:[r]}function e(r){return r.map(function(r){return""+r})}function n(r,t){if(!t)throw new Error("Must provide a key");return r.map(function(r){return r[t]})}function o(t){return r.isImmutable(t)}function u(r){var t=typeof r;return"function"===t||"object"===t&&!!r}function i(r){var t=o(r);if(!t)throw new Error("Not an immutable object")}function a(r){var t=!y(r),e=o(r);if(t||e)throw new Error("You must provide an array")}function f(r,t){if(t||(t="Not an object"),!u(r))throw new Error(t)}function c(){var r=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==t?e:3&e|8).toString(16)});return t}function m(r){r=r||{};for(var t=1,e=arguments.length;e>t;t++){var n=arguments[t];for(var o in n)void 0===r[o]&&(r[o]=n[o])}return r}function s(r,t){return v(r,t)}function v(t,e){var n,o;e&&f(e,"You must provide an object for arguments");var u={key:l};e=m(e,u),a(t);var i=r(t).asObject(function(r){return n=r[e.key],n||(n=c(),o={},o[e.key]=n,r=r.merge(o)),[n,r]});return x(i,e)}function x(r,o){function u(r){return v(r,o)}function a(r){return x(r,o)}function f(r,e){var u={strict:!1};if(e=m(e,u),e.strict){var i=t(r),a=n(i,o.key);if(l(a))throw new Error("Some records already exist")}return e.requireKey=!1,E(r,e)}function s(e){for(var n=t(e),o=0;o<n.length;o++){var u=n[o];if(!r[u])return!1}return!0}function l(e){for(var n=t(e),o=0;o<n.length;o++){var u=n[o];if(r[u])return!0}return!1}function y(){return d()}function d(){return Object.keys(r).map(function(t){return r[t].asMutable()})}function h(){return Object.keys(r).length}function w(r){var t=d();return t=t.filter(r),u(t)}function g(r){for(var t=d(),e=0;e<t.length;e++){var n=t[e];if(r(n))return n}return void 0}function b(t){var e=r[t];return e?e.asMutable():void 0}function p(r){var t=d();return t.map(r)}function k(n,o){var u=t(n);if(u=e(u),o&&o.strict&&!s(u))throw new Error("Some records do not exist");var i=r.without(u);return a(i)}function E(u,i){var f,s,v=t(u),x=n(v,o.key);x=e(x);var y=r.without(x),d={},h={strict:!1,requireKey:!0};if(i=m(i,h),i.strict&&l(x))throw new Error("Some records already exist");for(var w=0;w<v.length;w++){if(f=v[w],s=f[o.key],!s){if(i.requireKey)throw new Error("Record must have ."+o.key);s=c(),f[o.key]=s}if(!s)throw new Error("Record must have ."+o.key);d[s]=f}return y=y.merge(d),a(y)}function j(){return r}function S(e,u){var i={strict:!1};u=m(u,i);var f,c,s,v,x,y=t(e),d=r;if(u.strict){var h=t(e),w=n(h,o.key);if(l(w))throw new Error("Some records already exist")}for(var g=0;g<y.length;g++){if(c=y[g],f=c[o.key],!f)throw new Error("Record must have ."+o.key);v=r[f],x=v?v.merge(c):c,s={},s[f]=x,d=d.merge(s)}return a(d)}return i(r),{isImm:!0,add:f,allExist:s,anyExist:l,array:y,count:h,filter:w,find:g,get:b,replace:E,map:p,remove:k,toImmutable:j,update:S}}if(null==r)throw new Error("Immutable is null");var l="id",y=Array.isArray||function(r){return"[object Array]"===toString.call(r)};return s});
//! Imm
//! Immutable collections
//! (c) 2015 Sebastian Porto
//! MIT license.
//! https://github.com/sporto/imm
!function(r,t){if("function"==typeof define&&define.amd)define(["Immutable"],function(e){return r.imm=t(e)});else if("object"==typeof exports){var e=require("seamless-immutable");module.exports=t(e)}else r.imm=t(r.Immutable)}(this,function(r){"use strict";function t(r){return x(r)?r:[r]}function e(r){return r.map(function(r){return""+r})}function n(r,t){if(!t)throw new Error("Must provide a key");return r.map(function(r){return r[t]})}function o(t){return r.isImmutable(t)}function i(r){var t=o(r);if(!t)throw new Error("Not an immutable object")}function u(r){var t=!x(r),e=o(r);if(t||e)throw new Error("You must provide an array")}function a(){var r=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==t?e:3&e|8).toString(16)});return t}function f(r){r=r||{};for(var t=1,e=arguments.length;e>t;t++){var n=arguments[t];for(var o in n)void 0===r[o]&&(r[o]=n[o])}return r}function c(r,t){return m(r,t)}function m(t,e){var n,o;u(t),e=e||v;var i=r(t).asObject(function(r){return n=r[e],n||(n=a(),o={},o[e]=n,r=r.merge(o)),[n,r]});return s(i,e)}function s(r,o){function u(r){return m(r,o)}function c(r){return s(r,o)}function x(r,e){var i={strict:!1};if(e=f(e,i),e.strict){var u=t(r),a=n(u,o);if(d(a))throw new Error("Some records already exist")}return e.requireKey=!1,I(r,e)}function l(e){for(var n=t(e),o=0;o<n.length;o++){var i=n[o];if(!r[i])return!1}return!0}function d(e){for(var n=t(e),o=0;o<n.length;o++){var i=n[o];if(r[i])return!0}return!1}function h(){return w()}function w(){return Object.keys(r).map(function(t){return r[t].asMutable()})}function y(){return Object.keys(r).length}function g(r){var t=w();return t=t.filter(r),u(t)}function b(r){for(var t=w(),e=0;e<t.length;e++){var n=t[e];if(r(n))return n}return void 0}function p(t){var e=r[t];return e?e.asMutable():void 0}function E(r){var t=w();return t.map(r)}function j(n,o){var i=t(n);if(i=e(i),o&&o.strict&&!l(i))throw new Error("Some records do not exist");var u=r.without(i);return c(u)}function I(i,u){var m,s,v=t(i),x=n(v,o);x=e(x);var l=r.without(x),h={},w={strict:!1,requireKey:!0};if(u=f(u,w),u.strict){var v=t(i),x=n(v,o);if(d(x))throw new Error("Some records already exist")}for(var y=0;y<v.length;y++){if(m=v[y],s=m[o],!s){if(u.requireKey)throw new Error("Record must have ."+o);s=a(),m[o]=s}if(!s)throw new Error("Record must have ."+o);h[s]=m}return l=l.merge(h),c(l)}function S(){return r}function M(e,i){var u={strict:!1};i=f(i,u);var a,m,s,v,x,l=t(e),h=r;if(i.strict){var w=t(e),y=n(w,o);if(d(y))throw new Error("Some records already exist")}for(var g=0;g<l.length;g++){if(m=l[g],a=m[o],!a)throw new Error("Record must have ."+o);v=r[a],x=v?v.merge(m):m,s={},s[a]=x,h=h.merge(s)}return c(h)}return i(r),o=o||v,{isImm:!0,add:x,allExist:l,anyExist:d,array:h,count:y,filter:g,find:b,get:p,replace:I,map:E,remove:j,toImmutable:S,update:M}}if(null==r)throw new Error("Immutable is null");var v="id",x=Array.isArray||function(r){return"[object Array]"===toString.call(r)};return c});
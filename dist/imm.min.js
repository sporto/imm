!function(r,n){if("function"==typeof define&&define.amd)define(["Immutable"],function(t){return r.imm=n(t)});else if("object"==typeof exports){var t=require("seamless-immutable");module.exports=n(t)}else r.imm=n(r.Immutable)}(this,function(r){"use strict";function n(r){return m(r)?r:[r]}function t(r){return r.map(function(r){return""+r})}function e(r,n){return r.map(function(r){return r[n]})}function u(n){return r.isImmutable(n)}function o(r){var n=u(r);if(!n)throw new Error("Not an immutable object")}function i(r){var n=!m(r),t=u(r);if(n||t)throw new Error("You must provide an array")}function f(r,n){return a(r,n)}function a(n,t){i(n),t=t||l;var e=r(n).asObject(function(r){return[r[t],r]});return c(e,t)}function c(r,u){function i(r){return a(r,u)}function f(r){return c(r,u)}function m(t){var e,o,i,a,c=n(t);if(0===c.length)return f(r);for(var l=r,m=0;m<c.length;m++){if(o=c[m],e=o[u],!e)throw new Error("Invalid key");if(a=g(e))throw new Error("Record already exists");i={},i[e]=o,l=l.merge(i)}return f(l)}function s(){return v()}function v(){return Object.keys(r).map(function(n){return r[n].asMutable()})}function d(t){for(var e=n(t),u=0;u<e.length;u++){var o=e[u];if(!r[o])return!1}return!0}function h(){return Object.keys(r).length}function w(r){var n=v();return n=n.filter(r),i(n)}function b(r){for(var n=v(),t=0;t<n.length;t++){var e=n[t];if(r(e))return e}return void 0}function g(n){var t=r[n];return t?t.asMutable():void 0}function p(r){var n=v();return n.map(r)}function y(e){var u=n(e);if(!d(u))throw new Error("Not all records found");u=t(u);var o=r.without(u);return f(o)}function E(o){var i,a,c,l=n(o),m=e(l,u);m=t(m);for(var s=r.without(m),v={},d=0;d<l.length;d++){if(i=l[d],a=i[u],c=g(a),!c)throw new Error("Record "+a+" does not exists");v[a]=i}return s=s.merge(v),f(s)}function I(){return r}function j(t){for(var e,o,i,a,c=n(t),l=r,m=0;m<c.length;m++){if(o=c[m],e=o[u],!e)throw new Error("Record must have ."+u);if(a=r[e],!a)throw new Error("Record not found "+e);a=a.merge(o),i={},i[e]=a,l=l.merge(i)}return f(l)}return o(r),u=u||l,{isImm:!0,add:m,all:s,count:h,filter:w,find:b,get:g,replace:E,map:p,remove:y,toImmutable:I,update:j}}if(null==r)throw new Error("Immutable is null");var l="id",m=Array.isArray||function(r){return"[object Array]"===toString.call(r)};return f});
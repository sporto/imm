//! Imm
//! Immutable collections
//! (c) 2015 Sebastian Porto
//! MIT license.
//! https://github.com/sporto/imm
!function(r,e){if("function"==typeof define&&define.amd)define(["seamless-immutable"],function(t){return r.imm=e(t)});else if("object"==typeof exports){var t=require("seamless-immutable");module.exports=e(t)}else r.imm=e(r.Immutable)}(this,function(r){"use strict";function e(r){return y(r)?r:[r]}function t(r){return r.map(function(r){return""+r})}function n(r,e){if(!e)throw new Error("Must provide a key");return r.map(function(r){return r[e]})}function o(e){return r.isImmutable(e)}function u(r){var e=typeof r;return"function"===e||"object"===e&&!!r}function i(r){var e=o(r);if(!e)throw new Error("Not an immutable object")}function a(r){var e=!y(r),t=o(r);if(e||t)throw new Error("You must provide an array")}function f(r,e){if(e||(e="Not an object"),!u(r))throw new Error(e)}function c(){var r=(new Date).getTime(),e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)});return e}function m(r){r=r||{};for(var e=1,t=arguments.length;t>e;e++){var n=arguments[e];for(var o in n)void 0===r[o]&&(r[o]=n[o])}return r}function s(r,e){return v(r,e)}function v(e,t){var n,o;e||(e=[]),t&&f(t,"You must provide an object for arguments");var u={key:l};t=m(t,u),a(e);var i=r(e).asObject(function(r){return n=r[t.key],n||(n=c(),o={},o[t.key]=n,r=r.merge(o)),[n,r]});return x(i,t)}function x(r,o){function u(r){return v(r,o)}function a(r){return x(r,o)}function f(r,t){var u={strict:!1};if(t=m(t,u),t.strict){var i=e(r),a=n(i,o.key);if(l(a))throw new Error("Some records already exist")}return t.requireKey=!1,E(r,t)}function s(t){for(var n=e(t),o=0;o<n.length;o++){var u=n[o];if(!r[u])return!1}return!0}function l(t){for(var n=e(t),o=0;o<n.length;o++){var u=n[o];if(r[u])return!0}return!1}function y(){return d()}function d(){return Object.keys(r).map(function(e){return r[e].asMutable({deep:!0})})}function h(){return Object.keys(r).length}function w(r){var e=d();return e=e.filter(r),u(e)}function g(r){for(var e=d(),t=0;t<e.length;t++){var n=e[t];if(r(n))return n}return void 0}function b(e){var t=r[e];return t?t.asMutable({deep:!0}):void 0}function p(r){var e=d();return e.map(r)}function k(n,o){var u=e(n);if(u=t(u),o&&o.strict&&!s(u))throw new Error("Some records do not exist");var i=r.without(u);return a(i)}function E(u,i){var f,s,v=e(u),x=n(v,o.key);x=t(x);var y=r.without(x),d={},h={strict:!1,requireKey:!0};if(i=m(i,h),i.strict&&l(x))throw new Error("Some records already exist");for(var w=0;w<v.length;w++){if(f=v[w],s=f[o.key],!s){if(i.requireKey)throw new Error("Record must have ."+o.key);s=c(),f[o.key]=s}if(!s)throw new Error("Record must have ."+o.key);d[s]=f}return y=y.merge(d),a(y)}function j(){return r}function S(t,u){var i={strict:!1};u=m(u,i);var f,c,s,v,x,y=e(t),d=r;if(u.strict){var h=e(t),w=n(h,o.key);if(l(w))throw new Error("Some records already exist")}for(var g=0;g<y.length;g++){if(c=y[g],f=c[o.key],!f)throw new Error("Record must have ."+o.key);v=r[f],x=v?v.merge(c):c,s={},s[f]=x,d=d.merge(s)}return a(d)}return i(r),{isImm:!0,add:f,allExist:s,anyExist:l,array:y,count:h,filter:w,find:g,get:b,replace:E,map:p,remove:k,toImmutable:j,update:S}}if(null==r)throw new Error("Immutable is null");var l="id",y=Array.isArray||function(r){return"[object Array]"===toString.call(r)};return s});